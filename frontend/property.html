<!DOCTYPE html>
<html lang="vi"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Quản lý Nhà Trọ - TroViet</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
<script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#009688",
                        "background-light": "#f3f4f6",
                        "background-dark": "#111827",
                        "sidebar-bg": "#1e3a8a",
                        "sidebar-bg-dark": "#0f172a",
                    },
                    fontFamily: {
                        display: ["Inter", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "0.5rem",
                        'xl': "0.75rem",
                        '2xl': "1rem",
                        '3xl': "1.5rem",
                    },
                },
            },
        };
    </script>
<link rel="stylesheet" href="css/trangchu.css"/>
<link rel="stylesheet" href="css/property.css">
</head>
<body>
<div class="main-container">
<aside class="sidebar">
<div class="sidebar-header">
<div class="logo-icon">
<span class="material-icons-outlined">home</span>
</div>
<div class="logo-text">
<h1>TroViet</h1>
<p>Công Chủ nhà</p>
</div>
</div>
<div class="user-section">
<div class="user-avatar">
<span class="material-icons-outlined">person</span>
</div>
<div class="user-info">
<p>Admin</p>
<p>admin@troviet.com</p>
</div>
<button class="notif-btn">
<span class="material-icons-outlined">notifications</span>
</button>
</div>
<nav class="nav-menu">
<a class="nav-link" href="trangchu.html">
<span class="material-icons-outlined nav-icon">bar_chart</span>
<span>Tổng quan</span>
</a>
<a class="nav-link active" href="property.html">
<span class="material-icons-outlined nav-icon">apartment</span>
<span>Bất động sản</span>
</a>
<a class="nav-link" href="contract.html">
<span class="material-icons-outlined nav-icon">people_outline</span>
<span>Người thuê</span>
</a>
<a class="nav-link" href="invoices.html">
<span class="material-icons-outlined nav-icon">attach_money</span>
<span>Hóa đơn</span>
</a>
<a class="nav-link" href="maintenance.html">
<span class="material-icons-outlined nav-icon">build</span>
<span>Bảo trì</span>
</a>
</nav>
<div class="sidebar-footer">
<a class="nav-link" href="#">
<span class="material-icons-outlined nav-icon">settings</span>
<span>Cài đặt</span>
</a>
<a class="nav-link" href="#">
<span class="material-icons-outlined nav-icon">logout</span>
<span>Đăng xuất</span>
</a>
</div>
</aside>
<main class="main-content bg-background-light dark:bg-background-dark p-6 md:p-10 transition-colors duration-200">
        <header class="top-header">
            <div class="page-title">
                <h2>Bất động sản</h2>
                <p>Quản lý danh sách nhà trọ và phòng</p>
            </div>
            <button class="btn-primary" onclick="openModal('modal-house')">
                <i class="fas fa-home"></i>
                <i class="fas fa-plus" style="font-size: 0.75rem;"></i>
                <span>Thêm Nhà trọ</span>
            </button>
        </header>

        <div class="content-scroll">
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue"><i class="fas fa-home"></i></div>
                    <p class="stat-label">Tổng số phòng</p>
                    <p class="stat-value" id="stat-total">...</p>
                </div>
                <div class="stat-card">
                    <div class="stat-icon green"><i class="fas fa-user-check"></i></div>
                    <p class="stat-label">Đã thuê</p>
                    <p class="stat-value" id="stat-occupied">...</p>
                </div>
                <div class="stat-card">
                    <div class="stat-icon red"><i class="fas fa-door-open"></i></div>
                    <p class="stat-label">Còn trống</p>
                    <p class="stat-value" id="stat-vacant">...</p>
                </div>
                <div class="stat-card">
                    <div class="stat-icon purple"><i class="fas fa-chart-line"></i></div>
                    <p class="stat-label">Doanh thu dự kiến</p>
                    <p class="stat-value" id="stat-revenue">...</p>
                </div>
            </div>

            <!-- Thanh tìm kiếm -->
            <div style="margin-bottom: 1rem;">
                <div style="position: relative; max-width: 400px;">
                    <i class="fas fa-search" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #9ca3af; font-size: 0.875rem;"></i>
                    <input type="text" id="searchHouseRoom" placeholder="Tìm kiếm theo tên phòng, tên nhà..." style="width: 100%; padding: 0.625rem 0.75rem 0.625rem 2.5rem; border: 1px solid #e5e7eb; border-radius: 0.5rem; font-size: 0.875rem; outline: none; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.05);" onfocus="this.style.borderColor='#1D4ED8'; this.style.boxShadow='0 0 0 3px rgba(29, 78, 216, 0.1)';" onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.05)';" oninput="filterHousesAndRooms(this.value)">
                </div>
            </div>

            <!-- Danh sách nhà trọ và phòng trọ trong cùng một div -->
            <div class="houses-section" style="margin-bottom: 1.5rem; background: white; border-radius: 1rem; border: 1px solid #e5e7eb; padding: 0.96rem 1.6rem; position: relative; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                <!-- Phần nhà trọ -->
                <div style="display: flex; flex-direction: row; justify-content: space-between; align-items: flex-start; gap: 1.5rem; margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid #f3f4f6;">
                    <div style="display: flex; align-items: flex-start; gap: 2rem; flex: 1; overflow-x: hidden; width: 100%; position: relative;">
                        <div style="display: flex; gap: 1rem; min-width: max-content;">
                            <!-- Nhà trọ được chọn (card lớn) -->
                            <div id="active-house-card" class="active-house-card" onclick="viewHouseDetail()" style="display: none; min-width: max-content; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.transform='scale(1.02)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                                <div style="display: flex; align-items: start; gap: 2rem;">
                                    <div class="house-icon-large" style="width: 64px; height: 64px; background: #DBEAFE; border-radius: 1rem; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                        <i class="fas fa-home" style="font-size: 2.5rem; color: #1D4ED8;"></i>
                                    </div>
                                    <div>
                                        <h3 id="active-house-name" style="font-size: 1.25rem; font-weight: 700; color: #1D4ED8; margin: 0 0 0.25rem 0; word-wrap: break-word;">Tên nhà trọ</h3>
                                        <p id="active-house-address" style="font-size: 0.875rem; color: #6b7280; margin: 0 0 0.5rem 0; display: flex; align-items: center; gap: 0.25rem;">
                                            <i class="fas fa-map-marker-alt" style="font-size: 1rem;"></i>
                                            <span>Địa chỉ nhà trọ</span>
                                        </p>
                                        <table style="min-width: 100%; border-collapse: collapse;">
                                            <tbody>
                                                <tr>
                                                    <td style="padding: 0.5rem 0; white-space: nowrap;">
                                                        <div>
                                                            <p style="font-size: 0.75rem; color: #9ca3af; text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px; margin: 0 0 0.25rem 0;">Doanh thu tháng</p>
                                                            <p id="active-house-revenue" style="font-size: 1.125rem; font-weight: 700; color: #1f2937; margin: 0;">0 đ</p>
                                                        </div>
                                                    </td>
                                                    <td style="padding: 0.5rem 0; white-space: nowrap; text-align: right;">
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Danh sách nhà trọ khác (icon bên phải) -->
                            <div class="house-tabs" id="house-tabs-container" style="display: flex; flex-direction: row; gap: 1rem; flex-wrap: wrap;">
                                <span style="padding: 10px; color: gray; font-size: 0.875rem;">Đang tải danh sách nhà...</span>
                            </div>
                        </div>
                        
                        <!-- Nút mũi tên chuyển trang nhà trọ -->
                        <button id="houses-nav-next-btn" class="houses-nav-btn" onclick="nextHousesPage()" style="display: none; background: transparent; border: none; cursor: pointer; color: #1D4ED8; transition: all 0.2s; position: absolute; right: 0; top: 50%; transform: translateY(-50%);">
                            <i class="fas fa-chevron-circle-right" style="font-size: 2rem;"></i>
                        </button>
                    </div>
                    
                    <!-- Nút Thêm Phòng độc lập ở bên phải -->
                    <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 0.75rem; flex-shrink: 0;">
                        <button class="btn-add-room-top" onclick="checkAndOpenRoomModal()" style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 0.625rem 1rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.2s; white-space: nowrap;" onmouseover="this.style.boxShadow='0 2px 6px rgba(0,0,0,0.15)';" onmouseout="this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)';">
                            <i class="fas fa-plus" style="color: #059669; font-size: 1rem;"></i>
                            <span style="color: #059669; font-size: 0.875rem; font-weight: 500;">Thêm Phòng</span>
                        </button>
                    </div>
                </div>

                <!-- Phần danh sách phòng -->
                <div class="rooms-section" style="position: relative;">
                    <div class="rooms-grid" id="rooms-container">
                        <!-- Phòng sẽ được thêm vào đây -->
                    </div>
                    
                    <!-- Nút mũi tên chuyển trang phòng -->
                    <div style="position: absolute; top: 0; right: 0; display: flex; flex-direction: column; gap: 0.75rem; z-index: 10;">
                        <button id="rooms-next-btn" class="rooms-nav-btn-top" onclick="nextRoomsPage()" style="display: none; width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3); transition: all 0.2s;">
                            <i class="fas fa-chevron-right" style="color: white; font-size: 1.25rem;"></i>
                        </button>
                        <button id="rooms-prev-btn" class="rooms-nav-btn-top" onclick="prevRoomsPage()" style="display: none; width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3); transition: all 0.2s;">
                            <i class="fas fa-chevron-left" style="color: white; font-size: 1.25rem;"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="modal-house" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <div>
                    <h3 class="modal-title">Tạo Bất động sản mới</h3>
                    <p class="modal-desc">Thêm tòa nhà, chung cư hoặc dãy trọ mới.</p>
                </div>
                <span class="close-btn" onclick="closeModal('modal-house')"><i class="fas fa-times"></i></span>
            </div>
            <div class="modal-body">
                <form id="form-house">
                    <div class="form-group">
                        <label class="form-label">Tên bất động sản <span class="required">*</span></label>
                        <div class="input-wrapper">
                            <i class="fas fa-home input-icon"></i>
                            <input type="text" id="inp-house-name" class="form-input" placeholder="Ví dụ: Chung cư Sunrise City">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Địa chỉ</label>
                        <div class="input-wrapper">
                            <i class="fas fa-map-marker-alt input-icon"></i>
                            <input type="text" id="inp-house-addr" class="form-input" placeholder="Địa chỉ chi tiết">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Dịch vụ chung (Mặc định cho các phòng)</label>
                        <div id="service-list-house" class="service-list-container">
                        </div>
                        <button type="button" class="btn-add-service" onclick="addServiceRow('house')">
                            <i class="fas fa-plus"></i> Thêm dịch vụ
                        </button>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Mô tả</label>
                        <textarea id="inp-house-desc" class="form-textarea" placeholder="Mô tả chung về khu trọ..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeModal('modal-house')">Hủy</button>
                <button class="btn-submit" onclick="submitHouse()">Tạo Bất động sản</button>
            </div>
        </div>
    </div>

    <div id="modal-room" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <h3 class="modal-title">Tạo Phòng mới</h3>
                <span class="close-btn" onclick="closeModal('modal-room')"><i class="fas fa-times"></i></span>
            </div>
            <div class="modal-body">
                <form id="form-room">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Số phòng <span class="required">*</span></label>
                            <div class="input-wrapper">
                                <i class="far fa-building input-icon"></i>
                                <input type="text" id="inp-room-number" class="form-input" placeholder="Ví dụ: P101">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tầng</label>
                            <div class="input-wrapper">
                                <i class="fas fa-layer-group input-icon"></i>
                                <input type="number" id="inp-room-floor" class="form-input" placeholder="1">
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Diện tích (m²)</label>
                            <div class="input-wrapper">
                                <i class="fas fa-ruler-combined input-icon"></i>
                                <input type="number" id="inp-room-area" class="form-input" placeholder="30">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Giá thuê (VNĐ) <span class="required">*</span></label>
                            <div class="input-wrapper">
                                <i class="fas fa-dollar-sign input-icon"></i>
                                <input type="text" id="inp-room-rent" class="form-input" placeholder="5000000">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Tiện nghi (Nội thất)</label>
                        <textarea id="inp-room-facilities" class="form-textarea" placeholder="Giường, Tủ, Điều hòa..."></textarea>
                    </div>
                </form>

                <div class="form-group">
                    <label class="form-label">Dịch vụ & Tiện ích (Kế thừa từ nhà + Riêng)</label>
                    <div id="service-list-room" class="service-list-container">
                    </div>
                    <button type="button" class="btn-add-service" onclick="addServiceRow('room')">
                        <i class="fas fa-plus"></i> Tạo thêm dịch vụ
                    </button>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeModal('modal-room')">Hủy</button>
                <button class="btn-submit" onclick="submitRoom()">Lưu phòng</button>
            </div>
        </div>
    </div>

    <!-- Modal Chi tiết Nhà trọ -->
    <div id="modal-house-detail" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <div>
                    <h3 class="modal-title" id="modal-house-detail-title">Chi tiết Nhà trọ</h3>
                    <p class="modal-desc" id="modal-house-detail-desc">Xem và chỉnh sửa thông tin nhà trọ</p>
                </div>
                <span class="close-btn" onclick="closeModal('modal-house-detail')"><i class="fas fa-times"></i></span>
            </div>
            <div class="modal-body">
                <form id="form-house-detail">
                    <div class="form-group">
                        <label class="form-label">Tên bất động sản <span class="required">*</span></label>
                        <div class="input-wrapper">
                            <i class="fas fa-home input-icon"></i>
                            <input type="text" id="inp-house-detail-name" class="form-input" placeholder="Ví dụ: Chung cư Sunrise City" readonly>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Địa chỉ</label>
                        <div class="input-wrapper">
                            <i class="fas fa-map-marker-alt input-icon"></i>
                            <input type="text" id="inp-house-detail-addr" class="form-input" placeholder="Địa chỉ chi tiết" readonly>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Dịch vụ chung (Mặc định cho các phòng)</label>
                        <div id="service-list-house-detail" class="service-list-container">
                        </div>
                        <button type="button" class="btn-add-service" id="btn-add-service-house-detail" onclick="addServiceRow('house-detail')" style="display: none;">
                            <i class="fas fa-plus"></i> Thêm dịch vụ
                        </button>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Mô tả</label>
                        <textarea id="inp-house-detail-desc" class="form-textarea" placeholder="Mô tả chung về khu trọ..." readonly></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeModal('modal-house-detail')">Đóng</button>
                <button class="btn-secondary" id="btn-edit-house" onclick="toggleEditHouse()" style="display: inline-block;">
                    <i class="fas fa-edit"></i> Chỉnh sửa
                </button>
                <button class="btn-submit" id="btn-save-house" onclick="saveHouseDetail()" style="display: none;">
                    <i class="fas fa-save"></i> Lưu thay đổi
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Chi tiết Phòng -->
    <div id="modal-room-detail" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <div>
                    <h3 class="modal-title" id="modal-room-detail-title">Chi tiết Phòng</h3>
                    <p class="modal-desc" id="modal-room-detail-desc">Xem và chỉnh sửa thông tin phòng</p>
                </div>
                <span class="close-btn" onclick="closeModal('modal-room-detail')"><i class="fas fa-times"></i></span>
            </div>
            <div class="modal-body">
                <!-- Phần khách thuê (nếu có) -->
                <div id="tenant-section" class="tenant-section" style="display: none; margin-bottom: 1.5rem; padding: 1rem; background: #f9fafb; border-radius: 0.5rem;">
                    <div style="margin-bottom: 0.75rem;">
                        <h4 style="font-size: 0.875rem; font-weight: 600; color: #374151; margin-bottom: 0.5rem;"><i class="fas fa-user"></i> Khách thuê đang thuê</h4>
                    </div>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div id="tenant-avatar-large" class="tenant-avatar-large" style="width: 60px; height: 60px; border-radius: 50%; background: #dbeafe; color: #2563eb; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.25rem;">AD</div>
                        <div class="tenant-info-detail" style="flex: 1;">
                            <p class="tenant-name-detail" id="tenant-name-detail" style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem;">Tên khách thuê</p>
                            <p class="tenant-phone-detail" id="tenant-phone-detail" style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">Số điện thoại</p>
                            <p class="tenant-email-detail" id="tenant-email-detail" style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">Email</p>
                            <p class="tenant-contract-detail" id="tenant-contract-detail" style="font-size: 0.75rem; color: #6b7280;">Hợp đồng: Từ ... đến ...</p>
                        </div>
                    </div>
                </div>

                <!-- Form thông tin phòng -->
                <form id="form-room-detail">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Số phòng <span class="required">*</span></label>
                            <div class="input-wrapper">
                                <i class="far fa-building input-icon"></i>
                                <input type="text" id="inp-room-detail-number" class="form-input" placeholder="Ví dụ: P101" readonly>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tầng</label>
                            <div class="input-wrapper">
                                <i class="fas fa-layer-group input-icon"></i>
                                <input type="number" id="inp-room-detail-floor" class="form-input" placeholder="1" readonly>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Diện tích (m²)</label>
                            <div class="input-wrapper">
                                <i class="fas fa-ruler-combined input-icon"></i>
                                <input type="number" id="inp-room-detail-area" class="form-input" placeholder="30" readonly>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Giá thuê (VNĐ) <span class="required">*</span></label>
                            <div class="input-wrapper">
                                <i class="fas fa-dollar-sign input-icon"></i>
                                <input type="text" id="inp-room-detail-rent" class="form-input" placeholder="5000000" readonly>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Tiện nghi (Nội thất)</label>
                        <textarea id="inp-room-detail-facilities" class="form-textarea" placeholder="Giường, Tủ, Điều hòa..." readonly></textarea>
                    </div>
                </form>

                <div class="form-group">
                    <label class="form-label">Dịch vụ & Tiện ích</label>
                    <div id="service-list-room-detail" class="service-list-container">
                    </div>
                    <button type="button" class="btn-add-service" id="btn-add-service-detail" onclick="addServiceRow('room-detail')" style="display: none;">
                        <i class="fas fa-plus"></i> Tạo thêm dịch vụ
                    </button>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeModal('modal-room-detail')">Đóng</button>
                <button class="btn-secondary" id="btn-edit-room" onclick="toggleEditRoom()" style="display: inline-block;">
                    <i class="fas fa-edit"></i> Chỉnh sửa
                </button>
                <button class="btn-submit" id="btn-save-room" onclick="saveRoomDetail()" style="display: none;">
                    <i class="fas fa-save"></i> Lưu thay đổi
                </button>
            </div>
        </div>
    </div>

    </main>
</div>
<script src="js/property.js"></script>
</body>
</html>
