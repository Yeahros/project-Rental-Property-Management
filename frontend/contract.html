<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TroViet - Quản lý người thuê</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="css/contract.css">
</head>
<body>

    <aside class="sidebar">
        <div class="brand">
            <div class="brand-icon"><i class="fa-solid fa-house"></i></div>
            <div class="brand-text"><h2>TroViet</h2><span>Cổng Chủ nhà</span></div>
        </div>
        <div class="user-profile">
            <div class="avatar-small"><i class="fa-solid fa-user"></i></div>
            <div class="user-info"><h4>Admin</h4><p>admin@troviet.com</p></div>
            <i class="fa-regular fa-bell" style="margin-left: auto; color: #9ca3af;"></i>
        </div>
        <ul class="nav-menu">
            <li class="nav-item"><a href="#" class="nav-link"><i class="fa-solid fa-chart-column"></i>Tổng quan</a></li>
            <li class="nav-item"><a href="#" class="nav-link"><i class="fa-solid fa-building"></i>Bất động sản</a></li>
            <li class="nav-item"><a href="#" class="nav-link active"><i class="fa-solid fa-users"></i>Người thuê</a></li>
            <li class="nav-item"><a href="#" class="nav-link"><i class="fa-solid fa-dollar-sign"></i>Hóa đơn</a></li>
            <li class="nav-item"><a href="#" class="nav-link"><i class="fa-solid fa-wrench"></i>Bảo trì</a></li>
        </ul>
        <div class="sidebar-footer">
            <ul class="nav-menu">
                <li class="nav-item"><a href="#" class="nav-link"><i class="fa-solid fa-gear"></i>Cài đặt</a></li>
                <li class="nav-item"><a href="#" class="nav-link"><i class="fa-solid fa-arrow-right-from-bracket"></i>Đăng xuất</a></li>
            </ul>
        </div>
    </aside>

    <main class="main-content">
        <header class="page-header">
            <div class="page-title">
                <h1>Quản lý Người thuê nhà</h1>
                <p>Quản lý hồ sơ và hợp đồng thuê</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="toggleModal()"><i class="fa-solid fa-plus"></i> Tạo hợp đồng mới</button>
            </div>
        </header>

        <section class="stats-container">
            <div class="stat-card">
                <div class="stat-icon green"><i class="fa-regular fa-user"></i></div>
                <span class="stat-label">Đang thuê</span>
                <span class="stat-value" id="stat-active">...</span>
            </div>
            <div class="stat-card">
                <div class="stat-icon red"><i class="fa-regular fa-circle-xmark"></i></div>
                <span class="stat-label">Chấm dứt hợp đồng</span>
                <span class="stat-value" id="stat-terminated">...</span>
            </div>
            <div class="stat-card">
                <div class="stat-icon gray"><i class="fa-regular fa-clock"></i></div>
                <span class="stat-label">Hết hạn</span>
                <span class="stat-value" id="stat-expired">...</span>
            </div>
        </section>

        <div class="filter-bar">
            <div class="search-input-wrapper">
                <i class="fa-solid fa-magnifying-glass"></i>
                <input type="text" class="search-input" placeholder="Tìm kiếm người thuê, căn hộ...">
            </div>
            
            <div class="dropdown" id="statusDropdown">
                <div class="dropdown-toggle" onclick="toggleDropdown()">
                    <span>Tất cả trạng thái</span>
                    <i class="fa-solid fa-chevron-down" style="font-size: 12px; color: #6b7280;"></i>
                </div>
                <div class="dropdown-menu">
                    <div class="dropdown-item active">Tất cả trạng thái</div>
                    <div class="dropdown-item">Đang thuê</div>
                    <div class="dropdown-item">Chấm dứt hợp đồng</div>
                    <div class="dropdown-item">Chưa thuê</div>
                </div>
            </div>
        </div>

        <div class="tenant-list">
            <div class="tenant-card">
                <div class="card-header">
                    <div class="user-summary">
                        <div class="avatar-large bg-blue-light">TM</div>
                        <div class="user-details">
                            <h3>Nguyễn Thị Mai <span class="badge badge-success">Đang thuê</span></h3>
                        </div>
                    </div>
                    <i class="fa-regular fa-circle-check check-icon"></i>
                </div>
                <div class="info-grid">
                    <div class="info-item"><label>Phòng</label><span><i class="fa-solid fa-location-dot"></i> 204B - Sunrise Heights</span></div>
                    <div class="info-item"><label>Thời hạn thuê</label><span><i class="fa-regular fa-calendar"></i> 01/01/2024 - 31/12/2025</span></div>
                    <div class="info-item"><label>SĐT</label><span><i class="fa-solid fa-phone"></i> 0912 345 678</span></div>
                    <div class="info-item"><label>Email</label><span><i class="fa-regular fa-envelope"></i> mai.nguyen@email.com</span></div>
                </div>
                <div class="info-grid" style="border-top: 1px dashed #e5e7eb; padding-top: 15px;">
                    <div class="info-item"><label>Tiền thuê tháng</label><span class="rent-price">4.500.000 đ</span></div>
                    <div class="info-item"></div>
                    <div class="info-item"><label>Trạng thái TT</label><span class="status-text ok">Đúng hạn</span></div>
                    <div class="info-item" style="text-align: right;"><label>Hết hạn HĐ</label><span style="font-weight: 600;">31/12/2025</span></div>
                </div>
                <div class="card-actions">
                    <button class="btn btn-sm btn-dark"><i class="fa-regular fa-eye"></i> Xem chi tiết</button>
                    <button class="btn btn-sm btn-light"><i class="fa-solid fa-clock-rotate-left"></i> Lịch sử thanh toán</button>
                    <button class="btn btn-sm btn-light"><i class="fa-solid fa-download"></i> Download hợp đồng</button>
                </div>
            </div>
        </div>
    </main>

    <div class="modal-overlay" id="contractModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2>Tạo Hợp đồng mới</h2>
                <button class="close-btn" onclick="toggleModal()"><i class="fa-solid fa-xmark"></i></button>
            </div>

            <div class="modal-body">
                <div class="form-section">
                    <h3 class="form-section-title"><i class="fa-solid fa-building"></i> Thông tin phòng</h3>
                    <div class="form-group">
                        <label class="form-label">Chọn phòng / Căn hộ <span class="text-red">*</span></label>
                        <select class="form-control" id="select-room-id">
                            <option disabled selected value="">Đang tải danh sách phòng...</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="form-section-title"><i class="fa-solid fa-user"></i> Thông tin người thuê</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Họ và tên <span class="text-red">*</span></label>
                            <input type="text" id="inp-fullname" class="form-control" placeholder="Nhập họ và tên người thuê">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Số điện thoại <span class="text-red">*</span></label>
                            <input type="tel" id="inp-phone" class="form-control" placeholder="Nhập số điện thoại">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Số CCCD/CMND <span class="text-red">*</span></label>
                            <input type="text" id="inp-id-card" class="form-control" placeholder="Nhập số CCCD/CMND">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Mật khẩu đăng nhập</label>
                            <div class="form-control-icon-wrapper">
                                <i class="fa-solid fa-key input-icon"></i>
                                <input type="text" id="inp-password" class="form-control has-icon" placeholder="Nhập mật khẩu mới">
                            </div>
                            <p style="font-size: 11px; color: #6b7280; margin-top: 4px;">* Thay đổi giá trị này sẽ cập nhật mật khẩu đăng nhập của khách.</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ảnh CCCD/CMND</label>
                        <p style="font-size: 13px; color: #6b7280; margin-bottom: 10px;">Tải lên ảnh mặt trước và mặt sau của giấy tờ tùy thân.</p>
                        
                        <div class="form-row">
                            <div class="form-row">
                                <div class="form-group">
                                    <span style="font-size: 13px; font-weight: 500; margin-bottom: 5px;">Mặt trước</span>
                                    <div class="upload-area">
                                        <div class="upload-default" id="default-front">
                                            <i class="fa-solid fa-id-card" style="font-size: 32px; color: #9ca3af; margin-bottom: 8px;"></i>
                                            <span class="upload-text">Tải ảnh lên</span>
                                        </div>
                                        
                                        <img src="" id="preview-front" class="preview-img" alt="Mặt trước">
                            
                                        <input type="file" id="file-cccd-front" class="file-input-hidden" accept="image/*"
                                               onchange="previewImage(this, 'preview-front', 'default-front')">
                                    </div>
                                </div>
                            
                                <div class="form-group">
                                    <span style="font-size: 13px; font-weight: 500; margin-bottom: 5px;">Mặt sau</span>
                                    <div class="upload-area">
                                        <div class="upload-default" id="default-back">
                                            <i class="fa-solid fa-address-card" style="font-size: 32px; color: #9ca3af; margin-bottom: 8px;"></i>
                                            <span class="upload-text">Tải ảnh lên</span>
                                        </div>
                            
                                        <img src="" id="preview-back" class="preview-img" alt="Mặt sau">
                            
                                        <input type="file" id="file-cccd-back" class="file-input-hidden" accept="image/*"
                                               onchange="previewImage(this, 'preview-back', 'default-back')">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="divider"></div>

                <div class="form-section">
                    <h3 class="form-section-title"><i class="fa-solid fa-file-signature"></i> Chi tiết hợp đồng</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ngày bắt đầu</label>
                            <input type="date" id="inp-start-date" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ngày kết thúc</label>
                            <input type="date" id="inp-end-date" class="form-control">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Tiền cọc (VND)</label>
                            <div class="form-control-icon-wrapper">
                                <i class="fa-solid fa-dollar-sign input-icon"></i>
                                <input type="text" id="inp-deposit" class="form-control has-icon" placeholder="0">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tiền thuê phòng (VND)</label>
                            <div class="form-control-icon-wrapper">
                                <i class="fa-solid fa-money-bill input-icon"></i>
                                <input type="text" id="inp-rent" class="form-control has-icon" value="5.500.000">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="divider"></div>

                <div class="form-section">
                    <h3 class="form-section-title"><i class="fa-solid fa-folder-open"></i> Hồ sơ & Ghi chú</h3>
                    <div class="form-group">
                        <label class="form-label">Hợp đồng đã ký (PDF)</label>
                        <label class="file-select-box">
                            <div class="file-info">
                                <div class="file-icon"><i class="fa-solid fa-file-pdf"></i></div>
                                <div style="display: flex; flex-direction: column;">
                                    <span style="font-weight: 700; font-size: 14px;">Chưa có tệp nào được chọn</span>
                                    <span style="font-size: 12px; color: #6b7280;">Nhấn để tải lên file PDF (Max 10MB)</span>
                                </div>
                            </div>
                            <span class="file-btn">Chọn file</span>
                            <input type="file" id="file-contract-pdf" style="display: none;" accept="application/pdf" onchange="document.getElementById('pdf-name-display').innerText = this.files[0].name">
                        </label>
                        <small id="pdf-name-display" style="color: blue;"></small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ghi chú thêm</label>
                        <textarea id="inp-notes" class="form-control" style="height: 100px; padding-top: 10px; resize: vertical;"></textarea>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-cancel" onclick="toggleModal()">Hủy</button>
                
                <button id="btn-create" class="btn-submit" onclick="submitCreateContract()">
                    <i class="fa-solid fa-circle-plus"></i> Tạo hợp đồng
                </button>
                
                <div id="action-buttons-edit" style="display: none; gap: 10px;">
                    <button class="btn-cancel" style="border-color: #ef4444; color: #ef4444;" onclick="terminateContract()">
                        <i class="fa-solid fa-ban"></i> Chấm dứt HĐ
                    </button>
                    <button id="btn-edit" class="btn-submit" onclick="enableEditMode()">
                        <i class="fa-solid fa-pen-to-square"></i> Cập nhật
                    </button>
                    <button id="btn-save" class="btn-submit" style="display: none;" onclick="saveContractChanges()">
                        <i class="fa-solid fa-floppy-disk"></i> Lưu
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/contract.js"></script>
</body>
</html>